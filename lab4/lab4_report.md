**University:** [ITMO University](https://itmo.ru/ru/)  
**Faculty:** [FTMI](https://ftmi.itmo.ru/)  
**Course:** [Cloud platforms as the basis of technology entrepreneurship](https://itmo-ict-faculty.github.io/cloud-platforms-as-the-basis-of-technology-entrepreneurship/)  
**Year:** 2025/2026  
**Group:** U4225  
**Author:** Vasilchenko Irina Sergeevna
**Lab:** Lab4  
**Date of create:** 04.12.2025  
**Date of finished:** 05.12.2025

# Лабораторная работа №4 "Разработка инфраструктуры MVP AI приложения"

## 1. Цели и задачи работы
**Цель:** создать прототип AI-приложения с базовой функциональностью.  

**Задачи:**
1. Предоставить исходные данные о приложении
2. Выбрать необходимые ресурсы с обоснованием
3. Продумать три состояния приложения и составить схему инфраструктуры для каждого в draw.io  
  3.1. Начальное  
  3.2. Для тестирования партнерами  
  3.3. Продовое решение  
5. Рассчитать расходы на содержание каждого из трех состояний
6. Рассчитать предполагаемую нагрузку для трех состояний приложения
7. Выбрать оптимальное решение исходя из предполагаемых нагрузок
8. Подвести итоги
9. Составить отчет по лабораторной работе


## Исходные данные о приложении

**BookViewer** – AI-ассистент по персонализированному подбору книги. Пользователь выбирает жанр и описывает желаемую книгу промптом. По итогу пользователь получает две рекомендации.  

**Функционал:**
1. Генерация ответа на основе промпта пользователя
2. Перезапуск генерации
3. Ссылка для покупки рекомендованных книг

## Выбор необходимых ресурсов с обоснованием, схемы инфраструктуры и расходы на содержание

### Начальная стадия

Монолитная архитектура

**Ресурсы**

1. Cloud Run: автоматическое масштабирование, оплата только за время обработки запросов, быстрое разворачивание сервиса.

2. Firestore. Бесплатный лимит, которого будет достаточно, не требует предварительной схемы данных.

3. Cloud Storage: Надежный и дешевый сервис для прототипа.

4. Vertex AI API. Модель уже обучена, простая интеграция, дешевле чем обучение собчтвенной модели

**Схема**
![New1](https://github.com/user-attachments/assets/81dc52b0-78cd-4c1e-815d-8c589a5599f5)


**Расходы**

### Тестирование партнерами
Микросервисы + очереди  

**Ресурсы**  
Разделение frontend и backend, добавление очереди для асинхронных задач. Firestone меняется на Cloud SQL, добавляется Cloud Pub/Sub для оркестрации асинхронной обработки длинных промптов и предотвращения таймаутов и Cloud Monitoring/Logging – подключаем детальный мониторинг и алертинг

**Схема**  
![2](https://github.com/user-attachments/assets/1566152c-be98-489d-9a23-b37ebc8a2c38)

**Расходы**  
### Продакшн

Kubernetes и собственная LLM. Выбор в пользу GKE Autopilot потому, что LLM требует контроля. Также предполагается, что сам сервис будет использоваться как инструмент продвижения для как крупных, так и небольших продавцов книг и будет высокое кол-во запросов.
**Ресурсы**  
Cloud Run меняется на Kubernetes autopilot для автоматического масштабирования и продвинутого управление трафиком (canary-деплойменты) и повышения отказоустойчивости

Добавляются выделенные GPU-ноды в Kubernetes для развертывания собственных тонко настроенных моделей. Это дешевле вызовов Gemini API при высокой нагрузке.

Прямые вызовы Gemini API → Собственный ML-сервис в Kybernetes + Vertex AI Matching Engine. Дает полный контроль над моделью, возможность A/B-тестирования, кастомных дообучений.
Добавляем Cloud Armor для защиты от DDoS-атак

Добавляем BigQuery для бизнес-аналитики  
**Схема**  
![3](https://github.com/user-attachments/assets/6d2036f8-539a-4257-88fc-b955185f6837)


## Предполагаемая нагрузка
**1. MVP:**  
- 50 уникальных пользователей в день  
- До 500 запросов  
- Пиковая нагрузка: 5-10 одновременных пользователей  

**2. Тестирование партнерами:**  
- До 1000 пользователей в день  
- 5 000-10 000 запросов  
- Пиковая нагрузка: 50-100 одновременных пользователей  

**3. Продакшн:**  
- От 10 000 пользователей в день  
- 50 000–200 000+ запросов  
Пиковая нагрузка: 1 000 одновременных пользователей

## Расходы
## Расчет расходов на содержание инфраструктуры (за 1 месяц)

| Ресурсы               | Начальная стадия | Тестирование партнерами | Продакшн |
|----------------------------------|------------------------|--------------------------------|-----------------------|
| **Compute**                      |                        |                                |                       |
| Cloud Run                        | $0         | $25                           | —                     |
| GKE Autopilot                    | —                      | —                              | $72 (базовая плата)  |
| GPU-ноды (NVIDIA T4/L4)          | —                      | —                              | $400–$800         |
| **Базы данных и хранилище**      |                        |                                |                       |
| Firestore                        | $0 (Free Tier)        | —                              | —                     |
| Cloud SQL (PostgreSQL, HA)       | —                      | $50                           | $150–$200           |
| Cloud Storage                    | $0.50                 | $5                            | $30–$50             |
| BigQuery                         | —                      | —                              | $50                  |
| **AI/ML-сервисы**                |                        |                                |                       |
| Vertex AI API (Gemini)           | $5                    | $50                           | —                     |
| Vertex AI Matching Engine        | —                      | —                              | $300                 |
| **Очереди и оркестрация**        |                        |                                |                       |
| Cloud Pub/Sub                    | —                      | $10                           | $30                  |
| **Сеть и безопасность**          |                        |                                |                       |
| Load Balancing                   | $0 (включено в Run)   | $18                           | $20                  |
| Cloud Armor                      | —                      | —                              | $50                  |
| **Мониторинг и логирование**     |                        |                                |                       |
| Cloud Monitoring/Logging         | —                      | $15                           | $30                  |
| **Приблизительная стоимость**     | **$5,50**             | **$173**                      | **$1,100–$1,500**   |

## Выбор оптимального решения
Скорее всего, оптимальным будет решение для тестирования партнерами.

В версии для прода предполагается собственная LLM для выхода на лидеров рынка (ЧитайГород, Озон, Wildberries и др.), однако для этого нужен маркетинг и денежные ресурсы. В то же время в отличие от других, продакшн-версия предполагает самую высокую окупаемость. Тестовая версия содержит базовый функционал и уязвима, она необходима для тестирования гипотезы, что такое приложеные повысит продажи.
